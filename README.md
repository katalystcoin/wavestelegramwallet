# Introduction
WavesTelegramWallet bot is an open-source Telegram wallet bot that uses AWS Lambda for provisioning.

# Set up
Clone this repo
Bash command: 
```bash
git clone git@github.com:katalystcoin/wavestelegramwallet.git
```

Make sure Python 3 is installed

use pip3 or pip-3.<x> to install pipenv
```bash
pip3 install pipenv
```
Install dependencies and setup Python virtualenv
```bash
 cd wavestelegramwallet
pipenv shell
pip install -r requirements.txt
```

`Pipenv` is a Python virtual environment manager - this is required because python dependencies are messy if you install them on the system's Python install.

Before doing anything in Python, make sure you activate the virtualenvironment by doing `pipenv shell` 
You can identify the pipenv shell that you are using by the virtualenvironment name that gets prepended to your shell prompt:
E.g `(wavestelegramwallet-147jnRO)`

```bash
ec2-user:~/environment/wavestelegramwallet (master) $ pipenv shell
Spawning environment shell (/bin/bash). Use 'exit' to leave.
ec2-user:~/environment/wavestelegramwallet (master) $ . /home/ec2-user/.local/share/virtualenvs/wavestelegramwallet-147jnRO-/bin/activate
(wavestelegramwallet-147jnRO-) ec2-user:~/environment/wavestelegramwallet (master) $ 
```

# Configuration

3 things to configure: aws credentials, config.py and zappa_settings.json

### AWS Credentials

Use command `aws configure` to set it up. [Configuring the AWS CLI - AWS Command Line Interface](https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-getting-started.html)

You will need the `AWS Access Key ID` and `AWS Secret Access Key` to complete this step
List of region names can be found at : [Regions and Availability Zones - Amazon Relational Database Service](https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/Concepts.RegionsAndAvailabilityZones.html) 
Example (Singapore): "ap-southeast-1" 
Default output format is not important in this application so you can just hit enter for the default


### config.py

This is the configuration file for the application, there is an example in `config_example.py`
Do configure all the settings as they are all used.

|Config Key|Description|
|-----------|------------|
|BOT_TOKEN|Obtain this from the BotFather|
|DB_TABLE_NAME|The name for the DynamoDB table, if it doesn't exist it will be created|
|SECRETS_TABLE_NAME|The name for the DynamoDB table used to store encrypted secrets, if it doesn't exist it will be created|
|DB_ENCRYPTION_KEY_ALIAS|Easy human readable label for the Amazon ARN that identifies the encryption key - anything here will do|
|NODE_URL|URL of the Waves Node that this bot will be connected to|
|NODE_API_KEY|API key of the Waves Node|
|NET_ID|"testnet" or "mainnet"

### zappa_settings.json

This is the configuration file for the serverless framework (Zappa)

Use `zappa init` command to set this up for you

Inputs required -
Environment name: I use `dev` for development deployment and `production` for bots that will actually be used
Private S3 Bucket name: Use the autogenerated one
App function modular path: bot_server.app
Deploy globally: no

Example zappa_settings.json
```json
{
    "production": {
        "app_function": "bot_server.app",
        "aws_region": "ap-southeast-1",
        "profile_name": "default",
        "project_name": "wavestelegramwa",
        "runtime": "python3.6",
        "s3_bucket": "zappa-6abc456sg"
    }
}
```


# First Time Deployment
If you have never used this software before, there are some initialization commands that have to be run only
on the first run.

### Initializing the Database
If you are deploying for the first time, please remember to initialize the DynamoDB Table using the following command:
```bash 
bash deploy.sh
```